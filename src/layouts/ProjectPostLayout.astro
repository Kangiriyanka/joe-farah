---
import BaseLayout from "../layouts/BaseLayout.astro";
import TableOfContents from "../components/TableOfContents.astro";
import GithubIcon from "../components/icons/GithubIcon.astro";
const { frontmatter, headings } = Astro.props;
---

<BaseLayout pageTitle={frontmatter.title}>
  <div class="grid">
    <div class="toc">
      <TableOfContents headings={headings} />
    </div>

    <div class="flex items-end gap-2"> 
      <GithubIcon/>  
      <a class="secondary-a" href={frontmatter.link}>Github Repo</a>
      {["K-Numbers"].includes(frontmatter.title) ? 
        <span> | <a class="secondary-a" href={frontmatter.store}>App Store Link</a></span> 
        : <span></span>
      }
    </div>
    <br/>
    <slot/>
  </div>



<div id="imageModal" class="image-modal-overlay" role="dialog" aria-modal="true" aria-label="Image viewer">
  <button class="close-modal" aria-label="Close modal">&times;</button>
  <img id="modalContent" src="" alt="">
</div>

<!-- Step 1: Target imageModal and modalContent -->
<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("imageModal");
    const modalImg = document.getElementById("modalContent");

    document.addEventListener("click", (e) => {
      // Closest: find the nearest img inside a post-img-container
      // No matter what inside the image area was clicked, find the image inside .post-img-container
      const clickedImg = e.target.closest(".post-img-container img");
      if (!clickedImg) return;

      modalImg.src = clickedImg.src;
      modalImg.alt = clickedImg.alt;
      modal.classList.add("active");
      // Prevent scrolling
      document.body.style.overflow = "hidden";
    });


    const closeModal = () => {
      modal.classList.remove("active");
      document.body.style.overflow = "";
      // Let the animation finish before clearing src
      setTimeout(() => { modalImg.src = ""; }, 300);
    };


    modal.addEventListener("click", closeModal);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("active")) closeModal();
    });
  });
</script>

<style>
  .post-img-container img {
    cursor: zoom-in;
    transition: transform 0.2s ease;
  }

  .post-img-container img:hover {
    transform: scale(1.02);
  }

  .image-modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    cursor: zoom-out;
  }

  .image-modal-overlay.active {
    display: flex;
    animation: fadeIn 0.3s ease;
  }

  .image-modal-overlay img {
    max-width: 90vw;
    max-height: 90vh; 
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: 4px;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    animation: zoomIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);

  }

  .close-modal {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    color: white;
    font-size: 2.5rem;
    cursor: pointer;
    line-height: 1;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes zoomIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }
</style>

</BaseLayout>